#!/bin/bash
#
# Removes test directories from the vendor directory since Composer does not
# have a setting for this.
# https://github.com/composer/composer/issues/1750
#

APP_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/.."
APP_DIR="`cd "${APP_DIR}";pwd`" # normalize path
VENDOR_DIR="${APP_DIR}/vendor"

echo "Deleting test directories..."

find $VENDOR_DIR -type d -name "tests" -o -name "Tests" | 
{
    cnt=0
    while read line; do
        rm -rf $line
        cnt=$((cnt + 1))
    done
    echo "... deleted ${cnt} test directories."
}

echo "Removing unnecessary Google client services..."
cd vendor/google/apiclient-services/src/Google
mv Service ServiceDelete
mkdir Service
mv ServiceDelete/Directory* Service
mv ServiceDelete/Oauth2* Service
rm -rf ServiceDelete
echo "... done."
