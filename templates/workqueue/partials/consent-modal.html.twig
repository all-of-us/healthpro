{% if consentType == 'primary' %}
    {% set consentTypeText = 'Primary' %}
    {% set currentStatusField = 'reconsentForStudyEnrollmentAuthored' %}
    {% set updatedField = 'consentForStudyEnrollmentAuthored' %}
    {% set FirstAgreeField = 'consentForStudyEnrollmentFirstYesAuthored' %}
    {% set currentStatusFieldFilePath = 'reconsentForStudyEnrollmentFilePath' %}
    {% set updatedFieldFilePath = 'consentForStudyEnrollmentFilePath' %}
{% else %}
    {% set consentTypeText = 'EHR' %}
    {% set currentStatusField = 'reconsentForElectronicHealthRecordsAuthored' %}
    {% set updatedField = 'consentForElectronicHealthRecordsAuthored' %}
    {% set FirstAgreeField = 'consentForElectronicHealthRecordsFirstYesAuthored' %}
    {% set currentStatusFieldFilePath = 'rconsentForElectronicHealthRecordsFilePath' %}
    {% set updatedFieldFilePath = 'consentForElectronicHealthRecordsFilePath' %}
{% endif %}
<div class="modal-header">
    <button type="button" class="close pmi-x-out hidden"><span>&times;</span></button>
    <h4 class="modal-title">View Historical {{ consentTypeText }} Consent</h4>
</div>
<div class="modal-body">
    <dl class="dl-horizontal">
        <dt>Name</dt>
        <dd>{{ participant.lastName }}, {{ participant.firstName }} {{ participant.middleName }}</dd>
        <dt>DOB</dt>
        <dd>{{ participant.dob ? participant.dob|date('n/j/Y') : '--' }}</dd>
        <dt>Participant ID</dt>
        <dd>{{ participant.id }}</dd>
    </dl>
    <table class="table table-bordered">
        <thead>
        <tr>
            <th>{{ consentTypeText }} Consent History</th>
            <th>Status</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>
                {{ attribute(participant, currentStatusField) ? _self.displayConsent(attribute(participant, currentStatusField), attribute(participant, currentStatusFieldFilePath), currentStatusField, participant.id) : '--' }}
            </td>
            <td>Current Status, Re-consented</td>
        </tr>
        <tr>
            <td>
                {{ attribute(participant, updatedField) ? _self.displayConsent(attribute(participant, updatedField), attribute(participant, updatedFieldFilePath), updatedField, participant.id) : '--' }}
            </td>
            <td>Updated</td>
        </tr>
        <tr>
            <td>
                {{ attribute(participant, FirstAgreeField) ? _self.displayConsent(attribute(participant, FirstAgreeField), attribute(participant, updatedFieldFilePath), FirstAgreeField, participant.id) : '--' }}
            </td>
            <td>First Agree to Participate</td>
        </tr>
        </tbody>
    </table>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
</div>
{% macro displayConsent(time, filePath, consentType, participantId) %}
    {% set consentTime = time|date('n/j/Y g:ia', app.user.timezone) %}
    {% if filePath %}
        <a href="{{ path('participant_consent', {id: participantId, consentType: consentType}) }}"
           target="_blank">{{ consentTime }}</a>
    {% else %}
        {{ consentTime }}
    {% endif %}
{% endmacro %}
