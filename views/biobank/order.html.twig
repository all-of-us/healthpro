{% extends 'base.html.twig' %}
{% block title %}Participant {{ participant.id }} - {% endblock %}
{% block body %}
    <div class="row">
        <div class="col-sm-4">
            <dl class="dl-horizontal">
                {% if is_granted('ROLE_SCRIPPS') %}
                    <dt>Participant ID</dt>
                    <dd>{{ participant.id }}</dd>
                {% endif %}
                <dt>Biobank ID</dt>
                <dd>{{ participant.biobankId }}</dd>
                <dt>Paired Awardee</dt>
                <dd>{{ participant.awardee ? app.getAwardeeDisplayName(participant.awardee) : '(not paired)' }}</dd>
                <dt>Paired Site</dt>
                <dd>{{ participant.site ? app.getSiteDisplayName(participant.siteSuffix) : '(not paired)' }}</dd>
            </dl>
        </div>
        <div class="col-sm-4">
            <p class="lead">
                Order ID: <strong>{{ order.order_id }}</strong>
            </p>
            <h3>
                <i class="fa fa-medkit" aria-hidden="true"></i>
                {{ order.created_ts|date('n/j/Y', app.userTimezone) }}
            </h3>
        </div>
    </div>

    {% if order.status == 'unlock' %}
        <div class="alert alert-warning well-sm">
            <i class="fa fa-info-circle" aria-hidden="true"></i>
            <strong>
                Unlocked for editing by {{ app.getUserEmailById(order.oh_user_id)|default('Unknown') }} at {{ app.getSiteDisplayName(order.oh_site) }} on {{ order.oh_created_ts|date('F j, Y g:ia', app.userTimezone) }}
            </strong>
        </div>
    {% elseif order.status == 'cancel' %}
        <div class="alert alert-danger well-sm">
            <i class="fa fa-info-circle" aria-hidden="true"></i>
            <strong>
                Cancelled by {{ app.getUserEmailById(order.oh_user_id)|default('Unknown') }} at {{ app.getSiteDisplayName(order.oh_site) }} on {{ order.oh_created_ts|date('F j, Y g:ia', app.userTimezone) }}
            </strong>
        </div>
    {% endif %}
    
    <div role="tabpanel">
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation">
                <a href="#collect" aria-controls="collect" role="tab" data-toggle="tab">
                    {% if order.collected_ts is not empty %}
                        <i class="fa fa-check-circle text-success" aria-hidden="true"></i>
                    {% endif %}
                    Collect
                </a>
            </li>
            <li role="presentation" {% if order.collected_ts is empty %} class="disabled" {% endif %}>
                <a href="#process" aria-controls="collect" role="tab" {% if order.collected_ts is not empty %} data-toggle="tab" {% endif %}>
                    {% if order.processed_ts is not empty %}
                        <i class="fa fa-check-circle text-success" aria-hidden="true"></i>
                    {% endif %}
                    Process
                </a>
            </li>
            <li role="presentation" {% if order.processed_ts is empty %} class="disabled" {% endif %}>
                <a href="#finalize" aria-controls="collect" role="tab" {% if order.processed_ts is not empty %} data-toggle="tab" {% endif %}>
                    {% if order.finalized_ts is not empty %}
                        <i class="fa fa-check-circle text-success" aria-hidden="true"></i>
                    {% endif %}
                    Finalize
                </a>
            </li>
        </ul>
        <br />
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane" id="collect">
                {% include 'partials/biobank-order-details.html.twig' with { type: 'collected' } %}
            </div>
            <div role="tabpanel" class="tab-pane" id="process">
                {% if order.collected_ts is not empty %}
                    {% include 'partials/biobank-order-details.html.twig' with { type: 'processed' } %}
                {% endif %}
            </div>
            <div role="tabpanel" class="tab-pane" id="finalize">
                {% if order.processed_ts is not empty %}
                    {% include 'partials/biobank-order-details.html.twig' with { type: 'finalized' } %}
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
{% block pagejs %}
    <script>
        $(document).ready(function() {
            // Switch tab to active step
            $(".nav-tabs a[href='#{{ currentStep }}']").tab('show');
        });
    </script>
{% endblock %}