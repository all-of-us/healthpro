{% extends 'base.html.twig' %}
{% import 'order-samples.html.twig' as samples %}
{% if order.type != 'saliva' %}
    {% form_theme collectForm 'form/simple_checkbox.html.twig' %}
{% endif %}
{% block title %}Collect - Order {{ order.order_id }} - {% endblock %}
{% block body %}
    {% include 'order-header.html.twig' with { active: 'collect' } %}

    {{ form_start(collectForm, { attr: { class: 'warn-unsaved' } }) }}
        {{ form_errors(collectForm) }}
        <div class="form-group{% if not collectForm.collected_ts.vars.valid %} has-error{% endif %}">
            {{ form_label(collectForm.collected_ts) }}
            <span class="toggle-help-image" data-caption="Collection time help text placeholder.">
                <i class="fa fa-question-circle" aria-hidden="true"></i><span class="sr-only">Help</span>
            </span>
            {{ form_widget(collectForm.collected_ts) }}
            {{ form_errors(collectForm.collected_ts) }}
        </div>

        <div class="form-group{% if not collectForm.collected_samples.vars.valid %} has-error{% endif %}">
            {{ form_label(collectForm.collected_samples) }}
            <span class="toggle-help-image" data-caption="Collected samples help text placeholder.">
                <i class="fa fa-question-circle" aria-hidden="true"></i><span class="sr-only">Help</span>
            </span>
            {% if order.type == 'saliva' %}
                {{ form_widget(collectForm.collected_samples) }}
            {% else %}
                {{ samples.form_widget(collectForm.collected_samples, order.finalized_ts ? false : true, samplesInfo) }}
            {% endif %}
            {{ form_errors(collectForm.collected_samples) }}
        </div>

        <div class="form-group{% if not collectForm.collected_notes.vars.valid %} has-error{% endif %}">
            {{ form_label(collectForm.collected_notes) }}
            <span class="toggle-help-image" data-caption="Collected notes help text placeholder.">
                <i class="fa fa-question-circle" aria-hidden="true"></i><span class="sr-only">Help</span>
            </span>
            {{ form_widget(collectForm.collected_notes) }}
            <small class="text-warning">Comments entered in this field must be transmitted to the Biobank via reconciliation reporting. You may not enter any participant identifying information here.</small>
            {{ form_errors(collectForm.collected_notes) }}
        </div>

        {{ form_rest(collectForm) }}
        {% if not order.finalized_ts %}
            <p>
                <button type="submit" class="btn btn-primary">
                    {% if order.collected_ts %}
                        Update
                    {% else %}
                        Save and mark as collected
                    {% endif %}
                </button>
            </p>
        {% endif %}
    {{ form_end(collectForm) }}
{% endblock %}

{% block pagejs %}
<script>
$(document).ready(function() {
    $('#checkall').on('change', function() {
        $('#form_collected_samples input:checkbox:enabled').prop('checked', $(this).prop('checked'));
    });
    $('#form_collected_ts').pmiDateTimePicker();
    var orderView = new PMI.views['OrderSubPage']({
        el: $("body")
    });
});
</script>
{% endblock %}
