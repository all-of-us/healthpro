{% extends 'base.html.twig' %}
{% block title %}Participant Work Queue - {% endblock %}
{% block bodycontainer %}container-fluid{% endblock %}
{% block body %}
    <div class="page-header">
        <h2>Participant Work Queue</h2>
    </div>
    <div class="well">
        <p><strong>Filters</strong> <small><a href="{{ path('workqueue_index') }}">reset</a></p>
        <form class="form-inline" id="filters">
            {% for name, filter in filters %}
                <select name="{{ name }}" class="form-control input-sm">
                    <option value="">-- {{ filter.label }} --</option>
                    {% for label, value in filter.options %}
                        <option value="{{ value }}"{% if params[name]|default(false) == value %} selected="selected"{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            {% endfor %}
        </form>
    </div>
    <div class="pull-right">
        <a href="{{ path('workqueue_export', params) }}" class="btn btn-xs btn-default"><i class="fa fa-download" aria-hidden="true"></i> Export</a>
    </div>
    <h4>{{ participants|length|number_format }}{{ params|length > 0 ? ' matching' : '' }} participant{{ participants|length == 1 ? '' : 's'}} at {{ app.session.get('site').name }}</h4>
    <table class="table table-striped table-bordered table-small">
        <thead>
            <tr>
                <th rowspan="2">Last Name</th>
                <th rowspan="2">First Name</th>
                <th rowspan="2">Preferred Contact</th>
                <th colspan="{{ surveys|length }}" class="topheader multiheader-survey">PPI Survey Completion</th>
                <th colspan="2" class="topheader multiheader-status">HealthPro Status</th>
            </tr>
            <tr>
                {% for field, label in surveys %}
                    <th class="secondaryheader multiheader-survey">{{ label }}</th>
                {% endfor %}
                <th class="secondaryheader multiheader-status">Phys Meas</th>
                <th class="secondaryheader multiheader-status">Biobank</th>
            </tr>
        </thead>
        <tbody>
            {% for participant in participants %}
                <tr>
                    <td>{{ participant.lastName }}</td>
                    <td>{{ participant.firstName }}</td>
                    <td>
                        <nobr>
                        {% if participant.preferredContact == 'EMAIL' %}
                            <i class="fa fa-envelope" aria-hidden="true"></i> <a href="mailto:{{ participant.emailAddress }}">{{ participant.emailAddress }}</a>
                        {% elseif participant.preferredContact == 'PHONE' %}
                            <i class="fa fa-phone" aria-hidden="true"></i> {{ participant.phoneNumber }}
                        {% elseif participant.preferredContact == 'MAIL' %}
                            <i class="fa fa-home" aria-hidden="true"></i> {{ participant.mailingAddress|replace({'\n': ', '}) }}
                        {% elseif participant.preferredContact == 'NO_CONTACT' %}
                            <i class="fa fa-minus-circle text-danger" aria-hidden="true"></i> No contact
                        {% endif %}
                        </nobr>
                    </td>
                    {% for field, label in surveys %}
                        <td class="text-center">
                            {% if participant['questionnaireOn' ~ field]|default('') == 'SUBMITTED' %}
                                <i class="fa fa-check text-success" aria-hidden="true"></i>
                            {% else %}
                                <i class="fa fa-times text-danger" aria-hidden="true"></i>
                            {% endif %}
                        </td>
                    {% endfor %}

                    <td class="text-center">
                        {% if participant.physicalEvaluationStatus == 'SUBMITTED' %}
                            <i class="fa fa-check text-success" aria-hidden="true"></i>
                        {% else %}
                            <i class="fa fa-times text-danger" aria-hidden="true"></i>
                        {% endif %}
                    </td>
                    <td class="text-center">
                        <strong class="text-{{ participant.biobankStatus == 7 ? 'success' : 'danger' }}">{{ participant.biobankStatus }}/7</strong>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <p class="text-right">
        <a href="{{ path('workqueue_export', params) }}" class="btn btn-xs btn-default"><i class="fa fa-download" aria-hidden="true"></i> Export</a>
    </p>
{% endblock %}

{% block pagejs %}
<script>
$(document).ready(function() {
    $('#filters select').change(function() {
        $('#filters').submit();
    })
});
</script>
{% endblock %}
