{% extends 'base.html.twig' %}
{% block title %}Participant Work Queue - {% endblock %}
{% block bodycontainer %}container-fluid{% endblock %}
{% block body %}
    <div class="page-header">
        <h2><i class="fa fa-table" aria-hidden="true"></i> Participant Work Queue</h2>
    </div>

    {% if isRdrError %}
        <div class="alert alert-danger">
            There was a problem with your request. Please refresh the page to try again.
        </div>
    {% endif %}

    <div class="well">
        <form id="filters">
            {% if filters.organization is defined %}
                <p><strong>Awardee</strong></p>
                <div class="form-inline">
                    <select name="organization" class="form-control input-sm">
                        {% for label, value in filters.organization.options %}
                            <option value="{{ value }}"{% if organization == value %} selected="selected"{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <br />
            {% endif %}
            <p><strong>Filters</strong> <small><a href="{{ path('workqueue_index') }}">reset</a></small></p>
            <div class="form-inline">
                {% for name, filter in filters if name != 'organization' %}
                    <select name="{{ name }}" class="form-control input-sm">
                        <option value="">-- {{ filter.label }} --</option>
                        {% for label, value in filter.options %}
                            <option value="{{ value }}"{% if params[name]|default(false) == value %} selected="selected"{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                {% endfor %}
            </div>
        </form>
    </div>

    {% if isDownloadDisabled == false %}
        <p class="text-right">
            <button data-href="{{ path('workqueue_export', params) }}" class="btn btn-xs btn-default export"><i class="fa fa-download" aria-hidden="true"></i> Export</button>
        </p>
    {% endif %}
    {# Not using siteAwardeeDisplayName field from session as the awardee/organization is variable for STSI users #}
    <h4 id="heading-count" style="display:none"><span class="count"></span> {{ params|length > 0 ? ' matching' }} participant<span class="plural">s</span> ({{ organization == 'salivary_pilot' ? 'Salivary Pilot' : app.getAwardeeDisplayName(organization) }})</h4>
    <table class="table table-striped table-bordered table-small" id="workqueue" width="100%" data-surveys="{{ surveys|json_encode() }}" data-samples="{{ samples|json_encode() }}" data-export-limit="{{ exportConfiguration.limit }}" data-dv-type="{{ app.isDvType }}">
        <thead>
            <tr>
                <th rowspan="2" class="col-group-name">Last Name</th>
                <th rowspan="2" class="col-group-name">First Name</th>
                <th rowspan="2" class="col-group-name">Middle Initial</th>

                <th rowspan="2" class="col-group-default">Date of Birth</th>
                <th rowspan="2" class="col-group-info">PMI ID</th>
                <th rowspan="2" class="col-group-info">Biobank ID</th>
                <th rowspan="2" class="col-group-info">Language</th>
                <th rowspan="2" class="col-group-default">Participant Status</th>
                <th rowspan="2" class="{{  app.isDvType ? 'col-group-default' : 'col-group-info' }}">Participant Origination</th>
                <th rowspan="2" class="col-group-default col-group-info">Consent Cohort</th>
                <th rowspan="2" class="col-group-info">First Primary Consent</th>
                <th rowspan="2" class="col-group-default col-group-info">Primary Consent</th>
                <th rowspan="2" class="col-group-default col-group-info">Program Update</th>
                <th rowspan="2" class="col-group-default col-group-info">Language of Primary Consent</th>
                <th rowspan="2" class="col-group-info">First EHR Consent</th>
                <th rowspan="2" class="col-group-default col-group-info">EHR Consent</th>
                <th rowspan="2" class="col-group-default col-group-info">EHR Expiration Status</th>
                <th rowspan="2" class="col-group-default col-group-info">gRoR Consent</th>
                <th rowspan="2" class="col-group-info">DV-only EHR Sharing <span title="Direct Volunteer participants are not asked to consent to share EHR data, but are asked if they would be willing to in the future." data-toggle="tooltip" data-container="body"><i class="fa fa-info-circle"></i></span></th>
                <th rowspan="2" class="col-group-info">CABoR Consent <span title="California Research Subjects' Bill of Rights is required for participants only by enrollment sites in California" data-toggle="tooltip" data-container="body"><i class="fa fa-info-circle"></i></span></th>
                <th rowspan="2" class="col-group-default col-group-info">Activity Status</th>
                <th rowspan="2" class="col-group-info">Withdrawal Reason</th>

                <th colspan="4" class="topheader multiheader-patient-status">Patient Status</th>

                <th colspan="5" class="topheader multiheader-contact">Contact</th>

                <th colspan="{{ 2 * (surveys|length) + 2 }}" class="topheader multiheader-survey">PPI Survey Completion</th>

                <th colspan="{{ (samples|length) + 7 }}" class="topheader multiheader-inperson">In-Person Enrollment</th>

                <th colspan="5" class="topheader multiheader-demographics">Demographics</th>
            </tr>
            <tr>
                <th class="secondaryheader col-group-patient-status multiheader-patient-status">Yes</th>
                <th class="secondaryheader col-group-patient-status multiheader-patient-status">No</th>
                <th class="secondaryheader col-group-patient-status multiheader-patient-status">No Access</th>
                <th class="secondaryheader col-group-patient-status multiheader-patient-status">Unknown</th>

                <th class="secondaryheader col-group-contact multiheader-contact">Contact Method</th>
                <th class="secondaryheader col-group-contact multiheader-contact">Address</th>
                <th class="secondaryheader col-group-contact multiheader-contact">Email <span title="This is either the registration email or the email provided after consent if the participant registered with a phone number" data-toggle="tooltip" data-container="body"><i class="fa fa-info-circle" aria-hidden="true"></i></span></th>
                <th class="secondaryheader col-group-contact multiheader-contact">Login Phone <span title="This is the verified SMS number used during registration" data-toggle="tooltip" data-container="body"><i class="fa fa-info-circle" aria-hidden="true"></i></span></th>
                <th class="secondaryheader col-group-contact multiheader-contact">Contact Phone <span title="This is the phone number provided after consent" data-toggle="tooltip" data-container="body"><i class="fa fa-info-circle" aria-hidden="true"></i></span></th>

                <th class="secondaryheader col-group-ppi col-group-default multiheader-survey">Required Complete?</th>
                <th class="secondaryheader col-group-ppi col-group-default multiheader-survey">Completed Surveys</th>
                {% for field, label in surveys %}
                    <th class="secondaryheader col-group-ppi multiheader-survey">{{ label }}</th>
                    <th class="secondaryheader col-group-ppi-time multiheader-survey">{{ label }} Date</th>
                {% endfor %}

                <th class="secondaryheader col-group-inperson col-group-default multiheader-inperson">Paired Site {{ display_message('pairing_info', 'tooltip')|raw }}</th>
                <th class="secondaryheader col-group-inperson col-group-default multiheader-inperson">Paired Organization {{ display_message('pairing_info', 'tooltip')|raw }}</th>
                <th class="secondaryheader col-group-inperson col-group-default multiheader-inperson">Phys Measurements</th>
                <th class="secondaryheader col-group-inperson multiheader-inperson">Phys Meas Site</th>
                <th class="secondaryheader col-group-inperson col-group-default multiheader-inperson">Samples for DNA Received?</th>
                <th class="secondaryheader col-group-inperson col-group-default multiheader-inperson">Bio&shy;specimens</th>
                {% for field, label in samples %}
                    <th class="secondaryheader col-group-inperson multiheader-inperson">{{ label }}</th>
                {% endfor %}
                <th class="secondaryheader col-group-inperson multiheader-inperson">Bio&shy;specimens Site</th>

                <th class="secondaryheader col-group-demographics multiheader-demographics">Age</th>
                <th class="secondaryheader col-group-demographics multiheader-demographics">Sex</th>
                <th class="secondaryheader col-group-demographics multiheader-demographics">Gender Identity</th>
                <th class="secondaryheader col-group-demographics multiheader-demographics">Race/Ethnicity</th>
                <th class="secondaryheader col-group-demographics multiheader-demographics">Education</th>
            </tr>
        </thead>
        <tbody id="participant_info"></tbody>
    </table>
    {% if isDownloadDisabled == false %}
        <p class="text-right">
            <button data-href="{{ path('workqueue_export', params) }}" class="btn btn-xs btn-default export"><i class="fa fa-download" aria-hidden="true"></i> Export</button>
        </p>
    {% endif %}
{% endblock %}

{% block pagejs %}
    {{ webpack_entry('workqueue', 'js') }}
{% endblock %}
